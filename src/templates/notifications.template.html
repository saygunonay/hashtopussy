{%TEMPLATE->struct/head%}
{%TEMPLATE->struct/menu%}
<h2>[[lang.get('myaccount_notifications')]]</h2>
{%TEMPLATE->struct/messages%}
<script type="text/javascript">
  var actionSettings = [[actionSettings]];

  function updateLists(){
    var id = $( "#actionType" ).val();
    $("#Task").hide();
    $("#Hashlist").hide();
    $("#Agent").hide();
    $("#User").hide();
    if(actionSettings[id] != "NONE" && actionSettings[id] != ""){
        $("#" + actionSettings[id]).show();
    }
  }
</script>
<div class="panel panel-default">
	<table class="table table-bordered table-nonfluid">
    <tr>
      <th colspan="7">
        [[lang.get('myaccount_notifications_create_notification')]]
      </th>
    </tr>
    <tr>
      <td colspan="7">
        <form action="notifications.php" method="post" class="form-inline">
          <input type="hidden" name="action" value="[[$DNotificationAction::CREATE_NOTIFICATION]]">
          <input type="hidden" name="csrf" value="[[csrf]]">
          [[lang.get('table_property_trigger_action')]]:
          <select id="actionType" name="actionType" class="form-control" onchange="updateLists()">
            {{FOREACH action;[[allowedActions]]}}
              <option value="[[action]]">[[allowedActionNames.get([[action]])]]</option>
            {{ENDFOREACH}}
          </select>

          <select id="Task" name="tasks" class="form-control">
            <option value="ALL">[[lang.getUCF('all')]]</option>
            {{FOREACH task;[[allTasks]]}}
              <option value="[[task.getId()]]">[[task.getTaskName()]] ([[task.getId()]])</option>
            {{ENDFOREACH}}
          </select>
          <select id="Agent" name="agents" class="form-control">
            <option value="ALL">[[lang.getUCF('all')]]</option>
            {{FOREACH agent;[[allAgents]]}}
              <option value="[[agent.getId()]]">[[agent.getAgentName()]] ([[agent.getId()]])</option>
            {{ENDFOREACH}}
          </select>
          <select id="Hashlist" name="hashlists" class="form-control">
            <option value="ALL">[[lang.getUCF('all')]]</option>
            {{FOREACH hashlist;[[allHashlists]]}}
              <option value="[[hashlist.getId()]]">[[hashlist.getHashlistName()]] ([[hashlist.getId()]])</option>
            {{ENDFOREACH}}
          </select>
          {{IF [[login.getLevel()]] >= 50}}
            <select id="User" name="users" class="form-control">
              <option value="ALL">[[lang.getUCF('all')]]</option>
              {{FOREACH user;[[allUsers]]}}
                <option value="[[user.getId()]]">[[user.getUsername()]] ([[user.getId()]])</option>
              {{ENDFOREACH}}
            </select>
          {{ENDIF}}

          [[lang.get('table_property_notification_type')]]:
          <select name="notification" class="form-control">
            {{FOREACH notification;[[allNotifications]]}}
              <option value="[[notification]]">[[notification]]</option>
            {{ENDFOREACH}}
          </select>

          [[lang.get('table_property_receiver')]]:
          <input type="text" name="receiver" class="form-control">

          <button type="submit" class="btn btn-success">[[lang.get('button_create')]]</button>
        </form>
      </td>
    </tr>
		<tr>
      <th>[[lang.get('table_property_id')]]</th>
      <th>[[lang.get('table_property_active')]]</th>
      <th>[[lang.get('table_property_trigger_action')]]</th>
      <th>[[lang.get('table_property_applied_to')]]</th>
      <th>[[lang.get('table_property_notification_type')]]</th>
      <th>[[lang.get('table_property_receiver')]]</th>
      <th>&nbsp;</th>
    </tr>
    {{FOREACH notification;[[notifications]]}}
      <tr>
        <td>[[notification.getId()]]</td>
        <td>
          <form id="active[[notification.getId()]]" action="notifications.php" method="post">
            <input type='hidden' name='action' value='[[$DNotificationAction::SET_ACTIVE]]'>
            <input type="hidden" name="notification" value="[[notification.getId()]]">
            <input type="hidden" name="csrf" value="[[csrf]]">
            <input type="checkbox" {{IF [[notification.getIsActive()]] == 1}} checked{{ENDIF}} onChange="javascript:document.getElementById('active[[notification.getId()]]').submit();">
          </form>
        </td>
        <td>[[allowedActionNames.get([[notification.getAction()]])]]</td>
        <td>[[allApplies.getVal([[notification.getId()]])]]</td>
        <td>[[notification.getNotification()]]</td>
        <td><code>[[htmlentities([[notification.getReceiver()]], ENT_QUOTES, "UTF-8")]]</code></td>
        <td>
          <form action="notifications.php" method="POST" onSubmit="if (!confirm('[[lang.get('post_confirm_msg_delete_notification', [ [[notification.getId()]] ])]]')) return false;">
            <input type='hidden' name='action' value='[[$DNotificationAction::DELETE_NOTIFICATION]]'>
            <input type="hidden" name="notification" value="[[notification.getId()]]">
            <input type="hidden" name="csrf" value="[[csrf]]">
            <input type="submit" class='btn btn-danger' value="[[lang.get('button_delete')]]">
          </form>
        </td>
      </tr>
    {{ENDFOREACH}}
	</table>
</div>
<script type="text/javascript">
  $( document ).ready(function() {
    updateLists();
  });
</script>
{%TEMPLATE->struct/foot%}
